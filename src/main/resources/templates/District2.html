<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bootstrap demo</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
	
	<script type="text/javascript">
		
		function getDistricts(countryId){
			console.log("Hello I am in getDistrict function, the countryId is: "+ countryId);
			
			const xhttp = new XMLHttpRequest();
			xhttp.open("GET", "/myapp/getStatesByCountryId?countryId="+countryId);
			
			  xhttp.onload = function() {
				  
				  if (xhttp.status == 200){
					  
					  console.log("response: ", this.responseText);
					   document.getElementById("state").innerHTML = this.responseText;
					  
				  }
			  }
			  
			  
			  xhttp.send();
			
			
		}	
	</script>
	
</head>
<body>



	<form method="post" th:action="@{/saveDistrict}" th:object="${district}">
	
	<input type="hidden" th:field="*{id}" >

		<div class="row">
			<div class="col-6">
			<div class="mt-5 ms-5 me-5" th:if="${successMessage != null}">
					<div class="alert alert-success" role="alert" th:text="${successMessage}"></div>
				</div>
				<div  class="alert alert-danger mt-5 ms-5 me-5" role="alert" th:if="${dangerMessage != null}" th:text="${dangerMessage}">
				  A simple danger alertâ€”check it out!
				</div>
				<h1 class="text-center mb-3">District Form</h1>

				<div class="row m-2">
					<div class="col-6">
						<label for="exampleInputEmail1" class="form-label">Country</label>

					</div>

					<div class="col-6">

						<select onchange="getDistricts(this.value);" th:field="*{state.country.id}" class="form-select" aria-label="Default select example">
							<option value="">Select Country</option>
							<option th:each="c : ${countries}" th:value="${c.id}" th:text="${c.countryName}">India</option>
							
						</select>
						
						<span th:if="${#fields.hasErrors('state.country.id')}"
								th:errors="*{state.country.id}" style="color: red"></span>

					</div>
				</div>
				<div class="row m-2">
					<div class="col-6">
						<label for="exampleInputEmail1" class="form-label">State</label>

					</div>

					<div class="col-6">

						<select id="state" th:field="*{state.id}" class="form-select" aria-label="Default select example">
							<option value="">Select State</option>
							<option th:each="s : ${states}" th:value="${s.id}" th:text="${s.stateName}">India</option>
							
						</select>
						
						<span th:if="${#fields.hasErrors('state.id')}"
								th:errors="*{state.id}" style="color: red"></span>

					</div>
				</div>
				<div class="row mt-3 m-2">
					<div class="col-6">
						<label for="exampleInputPassword1" class="form-label">District</label>

					</div>

					<div class="col-6">
						<input type="text" class="form-control" th:field="*{DistrictName}">
						
						<span th:if="${#fields.hasErrors('DistrictName')}"
								th:errors="*{DistrictName}" style="color: red"></span>

					</div>
				</div>

				<div class="row mt-3">
					<div class="col-6"></div>

					<div class="col-6">

						<button type="submit" class="btn btn-primary">Submit</button>

					</div>


				</div>

			</div>


			<div class="col-6">
				<h1 class="text-center mb-3">State List</h1>

				<table class="table">
					<thead>
						<tr>
							<th scope="col">S/N</th>
							<th scope="col">Country</th>
							<th scope="col">State</th>
							<th scope="col">District</th>
							<th scope="col">Action</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="dist, distStatus : ${allDistrict}">
							<th scope="row" th:text="${distStatus.index+1}">1</th>
							<td th:text="${dist.state.country.countryName}">hii </td>
							<td th:text="${dist.state.stateName}"></td>
							<td th:text="${dist.districtName}"></td>
							
							<td>
							    <a type="button" class="btn btn-primary" th:href="@{/editState(id=${dist.id})}">Edit</a>
							    <a type="button" class="btn btn-danger" th:href="@{/deleteState(id=${dist.id})}">Delete</a>
							</td>
						</tr>
						
						
					</tbody>
				</table>

			</div>
		</div>


	</form>


	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
</body>
</html>